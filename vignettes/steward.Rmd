---
title: "steward"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{steward}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = FALSE,
  comment = ""
)

# https://community.rstudio.com/t/showing-only-the-first-few-lines-of-the-results-of-a-code-chunk/6963/2
#
hook_output <- knitr::knit_hooks$get("output")
knitr::knit_hooks$set(
  output = function(x, options) {
    lines <- options$output.lines
    if (is.null(lines)) {
      return(hook_output(x, options))  # pass to default hook
    }
    x <- unlist(strsplit(x, "\n"))
    more <- "..."
    if (length(lines)==1) {        # first n lines
      if (length(x) > lines) {
        # truncate the output, but add ....
        x <- c(head(x, lines), more)
      }
    } else {
      x <- c(more, x[lines], more)
    }
    # paste these lines together
    x <- paste(c(x, ""), collapse = "\n")
    hook_output(x, options)
  }
)
```

```{r setup}
library("steward")
```

This package offers a set of S3 classes designed to store data-frame metadata for the purposes of documenting it, in a report or as roxygen data-documentation. 

These are the things we can do with steward objects:

- [create dataset](#create) 
- [write dataset to package with documentation](#write-to-package)

- [read from YAML](#read-yaml) 
- [write to YAML](#write-yaml)
- [write to roxygen](#write-roxygen) 
- [write to gt table](#write-gt-table) 

#### Create 

We use the **ggplot2** `diamonds` dataset as our example. We build up the data-frame metadata using `stw_mutate_meta()` and the column-metadata using `stw_mutate_dict()`:

```{r}
diamonds <-
  stw_dataset(ggplot2::diamonds) %>%
  stw_mutate_meta(
    name = "diamonds",
    title = "Prices of 50,000 round cut diamonds",
    description = "A dataset containing the prices and other attributes of almost 54,000 diamonds.",
    sources = list(
      list(
        title = "DiamondSearchEngine",
        path = "http://www.diamondse.info/"
      )
    )
  ) %>%
  stw_mutate_dict(
    price = "price in US dollars ($326--$18,823)",
    carat = "weight of diamond (0.2--5.01)",
    cut = "quality of the cut (Fair, Good, Very Good, Premium, Ideal)",
    color = "diamond color, from D (best) to J (worst)",
    clarity = "a measurement of how clear the diamond is (I1 (worst), SI2, SI1, VS2, VS1, VVS2, VVS1, IF (best))",
    x = "length in mm (0--10.74)",
    y = "width in mm (0--58.9)",
    z = "depth in mm (0--31.8)",
    depth = "total depth percentage = z / mean(x, y) = 2 * z / (x + y) (43--79)",
    table = "width of top of diamond relative to widest point (43--95)"
  )
```

```{r}
stw_check(diamonds, verbosity = "all")
```

#### Write to package

This bit assumes that you are working with a package project, where you want to include data with your package.

A `stw_dataset` object contains the data itself, along with its metadata. By keeping all the "stuff" together, we can verify that we have everything documented and current.

This allows us to write everything to a package. The function `stw_use_data()` wraps `usethis::use_data()` and `steward::stw_write_roxygen()`. For example:

```r
stw_use_data(diamonds_new)
```

Will write the `diamonds_new` dataset to your package, as well as roxygen documentation to `R/data-diamonds_new.R`.

#### Read YAML

Here are the first lines of a YAML file containing metadata from [ggplot2](http://ggplot2.tidyverse.org)'s `diamonds` dataset, which is available as:

```r
system.file("metadata/diamonds.yml", package = "steward")
```

```{r yaml, echo = FALSE, comment = "", output.lines = 11}
system.file("metadata/diamonds.yml", package = "steward") %>%
  readr::read_lines() %>%
  glue::glue_collapse(sep = "\n")
```

We can read a YAML file using `stw_read_meta_yaml()`:

```{r example_read_yaml}
stw_read_meta_yaml(system.file("metadata/diamonds.yml", package = "steward"))
```

#### Write YAML

To get a YAML string from metadata, you can use the `stw_to_yaml()` function. Here are the first few lines:

```{r stw_to_yaml, output, output.lines = 11}
cat(stw_to_yaml(diamonds_meta))
```

Other functions in this family:

- `stw_use_yaml()` copies the YAML string to the clipboard.
- `stw_write_yaml()` writes the YAML string to a file.

#### Write roxygen

To get a roxygen string from metadata, you can use the `stw_to_roxygen()` function:


```{r example_roxygen}
cat(stw_to_roxygen(diamonds_meta))
```

Other functions in this family:

- `stw_use_roxygen()` copies the roxygen string to the clipboard.
- `stw_write_roxygen()` writes the roxygen string to a file.

#### Write gt Table

If you are creating an R Markdown document, you can use the `stw_to_table()` function to create a [gt table](https://gt.rstudio.com):

```{r}
stw_to_table(diamonds_meta)
```

